---
keywords: "cursor, stable position, collaborative editing, CRDT, concurrent edits, selection, annotation, caret"
description: "Understanding cursor and stable position systems in Loro for maintaining accurate positions across concurrent edits"
---

# Cursor and Stable Positions

## Quick Reference

**Cursors** maintain stable positions across concurrent edits by anchoring to operation IDs instead of indices. Essential for collaborative editing features like shared cursors and persistent annotations.

## How It Works

Cursors anchor to operation IDs, not indices:

```
Text:    H e l l o   W o r l d
Op IDs:  1 2 3 4 5 6 7 8 9 A B
Cursor:  References ID 5 (after 'o')

After concurrent insert at start:
Text:    N e w   H e l l o   W o r l d  
Op IDs:  C D E F 1 2 3 4 5 6 7 8 9 A B
Cursor:  Still references ID 5 - position automatically adjusted
```

## Side Parameter

- **`Side.Before` (-1)**: Stay before the target
- **`Side.Middle` (0)**: On the target (default)
- **`Side.After` (1)**: Stay after the target

```ts twoslash
import { LoroDoc } from "loro-crdt";
// ---cut---
const doc = new LoroDoc();
const text = doc.getText("text");
text.insert(0, "ABC");

const cursor = text.getCursor(1, -1); // Before 'B'
text.insert(1, "X"); // Insert at cursor
// Result: "AXBC", cursor still before 'B'
```


## Common Use Cases

### Text Selections
```ts twoslash
import { LoroDoc } from "loro-crdt";
// ---cut---
const doc = new LoroDoc();
const text = doc.getText("text");
text.insert(0, "Hello World");

// Selection range
const start = text.getCursor(0, -1);  // Anchor
const end = text.getCursor(5, 1);     // Head
```

### List Positions
```ts twoslash
import { LoroDoc } from "loro-crdt";
// ---cut---
const doc = new LoroDoc();
const list = doc.getList("items");
list.insert(0, ["a", "b", "c"]);

const cursor = list.getCursor(1, 0); // After "a"
list.insert(0, "new"); // Cursor adjusts automatically
```

## Code Example

```ts twoslash
import { LoroDoc, LoroText, Cursor } from "loro-crdt";
// ---cut---
class CollaborativeSelection {
  private anchor!: Cursor;
  private head!: Cursor;
  
  constructor(
    private doc: LoroDoc,
    private text: LoroText
  ) {}

  setSelection(start: number, end: number) {
    this.anchor = this.text.getCursor(start, -1);
    this.head = this.text.getCursor(end, 1);
  }

  getSelection() {
    const anchorPos = this.doc.getCursorPos(this.anchor);
    const headPos = this.doc.getCursorPos(this.head);
    
    // Update cursors if optimized versions available
    if (anchorPos.update) this.anchor = anchorPos.update;
    if (headPos.update) this.head = headPos.update;
    
    return {
      start: Math.min(anchorPos.offset, headPos.offset),
      end: Math.max(anchorPos.offset, headPos.offset)
    };
  }
}
```

## Best Practices

- **Side parameters**: Use -1 for starts, 1 for ends, 0 for simple positions
- **Handle updates**: Check for and persist cursor updates
- **Account for deletions**: Check `position.side` for deleted content
- **UTF-16 awareness**: Emoji and special chars use multiple indices

## Related Documentation

- [Text Container](../containers/text) - Text editing with cursors
- [Collaborative Editing](../user-guide/collaborative-editing) - Building editors
- [Events](../user-guide/events) - Cursor change events