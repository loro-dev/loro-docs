# Import Status

## Quick Reference

**Import status** tells you what operations were applied and what's pending due to missing dependencies. Essential for handling out-of-order updates in distributed systems.

## Status Structure

```ts
interface ImportStatus {
  success: PeerVersionRange;  // What was applied
  pending?: PeerVersionRange; // What needs dependencies
}

interface PeerVersionRange {
  [peerId: string]: {
    start: number; // Inclusive
    end: number;   // Exclusive (e.g., 0-50 = ops 0-49)
  };
}
```


## Pending Operations

Operations become pending when they depend on missing operations (causal dependencies).

### Common Scenario: Out-of-Order Delivery

```ts twoslash
import { LoroDoc } from "loro-crdt";
// ---cut---
const doc = new LoroDoc();

// Peer A creates ops 0-9, then 10-19
const peerA = new LoroDoc();
peerA.getText("text").insert(0, "Hello");
const update1 = peerA.export({ mode: "update" });

peerA.getText("text").insert(5, " World");
const update2 = peerA.export({ mode: "update", from: peerA.version() });

// If update2 arrives first:
const status = doc.import(update2);
console.log(status.pending); // Ops 10-19 pending, need 0-9

// Import missing dependencies:
doc.import(update1); // Both updates now applied
```

## Handling Pending Operations

```ts twoslash
import { LoroDoc } from "loro-crdt";
// ---cut---
async function handleImport(
  doc: LoroDoc,
  update: Uint8Array,
  fetchMissing: (peerId: string, before: number) => Promise<Uint8Array>
) {
  const status = doc.import(update);
  
  if (status.pending) {
    // Fetch missing dependencies
    for (const [peerId, range] of Object.entries(status.pending)) {
      const missing = await fetchMissing(peerId, range.start);
      doc.import(missing); // Resolves pending ops
    }
  }
  
  return status;
}
```


## Best Practices

### Always Check Status
```ts twoslash
import { LoroDoc } from "loro-crdt";
// ---cut---
const status = doc.import(update);
if (status.pending) {
  console.warn("Operations pending:", status.pending);
  // Fetch missing dependencies
}
```

### Use Batch Import
```ts twoslash
import { LoroDoc } from "loro-crdt";
// ---cut---
const updates: Uint8Array[] = [];
const batchStatus = doc.importBatch(updates);
// Single status check for all updates
```

### Handle Edge Cases
- Empty updates (no new operations)
- All operations pending (missing initial state)
- Partial success (some applied, some pending)
- Corrupted update data

## Related Documentation

- [Version Representations](./version_representations) - Understanding version vectors
- [Synchronization Guide](../user-guide/sync) - Complete sync patterns
- [PeerID Management](./peerid_management) - How peer IDs affect import